<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Mental Health Assistant</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            height: 90vh; /* Full viewport height for chat layout */
        }
        #chat-window {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            background-color: #fafafa;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .message {
            max-width: 85%;
            padding: 0.75rem 1rem;
            border-radius: 1.5rem;
            word-wrap: break-word;
        }
        .user-message {
            background-color: #2563eb;
            color: #ffffff;
            align-self: flex-end;
            border-bottom-right-radius: 0.5rem;
        }
        .ai-message {
            background-color: #d1fae5;
            color: #065f46;
            align-self: flex-start;
            border-bottom-left-radius: 0.5rem;
        }
        .input-container {
            display: flex;
            gap: 0.5rem;
        }
        .input-field {
            flex-grow: 1;
            padding: 0.75rem;
            border-radius: 9999px;
            border: 1px solid #d1d5db;
            transition: all 0.2s ease-in-out;
        }
        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            white-space: nowrap;
        }
        .btn-primary {
            background-color: #2563eb;
            color: #ffffff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .btn-primary:hover {
            background-color: #1d4ed8;
            transform: translateY(-2px);
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top-color: #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-8">
    <div class="container">
        <h1 class="text-3xl sm:text-4xl font-extrabold mb-4 text-center text-gray-800">AI Mental Health Assistant</h1>
        <p class="text-gray-600 mb-6 text-center">Your supportive AI for general advice and information on mental well-being.</p>
        
        <div id="chat-window">
            <div class="ai-message">Hello. I'm an AI assistant designed to provide general support and information. I am not a substitute for a licensed mental health professional. If you are in crisis, please contact emergency services or a crisis hotline. How can I help you today?</div>
        </div>

        <div class="input-container">
            <input type="text" id="user-input" class="input-field" placeholder="Share how you're feeling...">
            <button id="send-btn" class="btn btn-primary flex items-center justify-center">
                <span id="send-btn-text">Send</span>
                <div id="loading-spinner" class="loading-spinner ml-2 hidden"></div>
            </button>
        </div>
    </div>
    
    <footer class="mt-8 text-center text-gray-500 text-sm">
        Made by uzair b2b services
    </footer>

    <script>
        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const sendBtnText = document.getElementById('send-btn-text');
        const loadingSpinner = document.getElementById('loading-spinner');

        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender === 'user' ? 'user-message' : 'ai-message');
            messageDiv.textContent = text;
            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        async function fetchWithBackoff(payload, retries = 5, delay = 1000) {
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    if (response.status === 429 && retries > 0) {
                        await new Promise(res => setTimeout(res, delay));
                        return fetchWithBackoff(payload, retries - 1, delay * 2);
                    } else {
                        throw new Error(`API error: ${response.statusText}`);
                    }
                }
                const result = await response.json();
                return result;

            } catch (error) {
                console.error("API call failed:", error);
                throw error;
            }
        }
        
        async function sendMessage() {
            const userText = userInput.value.trim();
            if (!userText) return;

            addMessage(userText, 'user');
            userInput.value = '';

            sendBtn.disabled = true;
            sendBtnText.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');

            try {
                addMessage("I'm listening...", 'ai');
                
                const prompt = `You are a compassionate and helpful AI designed to act as a mental health support assistant. Your purpose is to listen, offer empathetic responses, and provide general advice on coping mechanisms, mindfulness, or common emotional challenges. You must always start by saying "Thank you for sharing that with me." You must also include a clear disclaimer that you are not a medical professional and cannot provide a diagnosis or substitute for professional help. If the user expresses a desire to harm themselves or others, immediately provide a crisis hotline number like 988 in the U.S. or other relevant local numbers.
                
                User's message: ${userText}
                
                Based on this, please provide a supportive and informative response.`;

                const chatHistory = [{
                    role: "user",
                    parts: [{ text: prompt }]
                }];
                const payload = { contents: chatHistory };

                const result = await fetchWithBackoff(payload);
                const aiResponse = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                if (aiResponse) {
                    addMessage(aiResponse, 'ai');
                } else {
                    addMessage("I'm sorry, I was unable to generate a response. Please try again.", 'ai');
                }
            } catch (error) {
                console.error(error);
                addMessage("An error occurred. Please try again.", 'ai');
            } finally {
                sendBtn.disabled = false;
                sendBtnText.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
            }
        }

        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
