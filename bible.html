<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UZAIR B2B A.I. (Bible Chatbot)</title>
    <!-- Font link for Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- CDN for Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- CDN for Vue.js to handle reactivity and logic -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Font Awesome for copy and home icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-gray-100 font-sans antialiased min-h-screen flex flex-col">

    <!-- Vue.js app container -->
    <div id="app" class="flex flex-col flex-grow text-gray-800">

        <!-- Main Chat Container, responsive sizing for different devices -->
        <div class="flex flex-col flex-grow w-full max-w-4xl mx-auto rounded-xl shadow-lg overflow-hidden bg-white mt-6 mb-6 md:mt-12 md:mb-6">

            <!-- Header with responsive spacing and alignment -->
            <div class="flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 flex-wrap">
                <h1 class="text-xl sm:text-3xl font-extrabold text-gray-900 mb-2 sm:mb-0">UZAIR B2B A.I. (Bible Chatbot)</h1>
                <div class="flex items-center space-x-2">
                    <!-- Home Button with responsive padding -->
                    <a href="index.html" class="px-3 py-1 sm:px-4 sm:py-2 bg-gray-200 text-gray-700 rounded-full text-sm font-semibold shadow-md hover:bg-gray-300 transition-colors duration-200 flex items-center">
                        <i class="fas fa-home mr-2"></i>
                        Home
                    </a>
                    <p class="text-xs sm:text-sm text-gray-500">
                        Made by
                        <span class="text-blue-600">uzair b2b services</span>
                    </p>
                </div>
            </div>

            <!-- Chat Messages Window, uses flex-grow to take available space -->
            <div class="flex flex-col flex-grow h-0 p-4 sm:p-6 overflow-y-auto space-y-4" ref="chatWindow">
                <!-- Initial AI message -->
                <div class="flex items-start">
                    <div class="flex-shrink-0 w-8 h-8 mr-3 rounded-full bg-blue-600 flex items-center justify-center text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5L6 11h2.586l1.293-1.293a1 1 0 011.414 0L14 13.414V11a1 1 0 10-2 0v2.414l-1.293-1.293a1 1 0 00-1.414 0L8 14.586V13a1 1 0 00-2 0v3a1 1 0 001 1h8a1 1 0 001-1V9a1 1 0 00-1-1z" />
                        </svg>
                    </div>
                    <div class="bg-gray-100 rounded-xl px-4 py-2 max-w-sm sm:max-w-lg shadow-sm">
                        Hello! I am a chatbot here to help you understand the profound wisdom of the Holy Bible. What would you like to know?
                    </div>
                </div>

                <!-- Dynamic chat messages -->
                <div v-for="(message, index) in messages" :key="index" :class="['flex', {'justify-end': message.isUser, 'justify-start': !message.isUser}]">
                    <!-- User message with responsive max-width -->
                    <div v-if="message.isUser" class="bg-blue-600 text-white rounded-xl px-4 py-2 max-w-sm sm:max-w-xl shadow-sm">
                        {{ message.text }}
                    </div>
                    <!-- AI message with copy button and responsive max-width -->
                    <div v-else class="bg-gray-100 rounded-xl px-4 py-2 max-w-sm sm:max-w-xl shadow-sm flex items-end justify-between">
                        <span class="mr-4">{{ message.text }}</span>
                        <button @click="copyResponse(message.text)" class="text-gray-400 hover:text-gray-600 transition-colors duration-200">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>

                <!-- Loading spinner for AI response -->
                <div v-if="isLoading" class="flex items-start">
                    <div class="flex-shrink-0 w-8 h-8 mr-3 rounded-full bg-blue-600 flex items-center justify-center text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5L6 11h2.586l1.293-1.293a1 1 0 011.414 0L14 13.414V11a1 1 0 10-2 0v2.414l-1.293-1.293a1 1 0 00-1.414 0L8 14.586V13a1 1 0 00-2 0v3a1 1 0 001 1h8a1 1 0 001-1V9a1 1 0 00-1-1z" />
                        </svg>
                    </div>
                    <div class="bg-gray-100 rounded-xl px-4 py-2 shadow-sm animate-pulse">
                        <div class="w-8 h-2 bg-gray-300 rounded-full"></div>
                    </div>
                </div>
            </div>

            <!-- Input and Send Button, responsive spacing and sizing -->
            <div class="flex items-center p-4 sm:p-6 border-t border-gray-200">
                <input
                    v-model="userMessage"
                    @keyup.enter="sendMessage"
                    type="text"
                    placeholder="Ask me about the Holy Bible..."
                    class="flex-grow px-4 py-2 sm:px-5 sm:py-3 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out"
                    :disabled="isLoading"
                />
                <button
                    @click="sendMessage"
                    class="ml-3 px-4 py-2 sm:px-6 sm:py-3 rounded-full bg-blue-600 text-white font-semibold shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base"
                    :disabled="isLoading || !userMessage.trim()"
                >
                    <span v-if="!isLoading">Send</span>
                    <svg v-else class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Scroll to top button -->
    <button v-show="showScrollToTop" @click="scrollToTop" class="fixed bottom-6 right-6 p-4 rounded-full bg-blue-600 text-white shadow-lg hover:bg-blue-700 transition-all duration-300">
        <i class="fas fa-arrow-up"></i>
    </button>
    
    <!-- Footer -->
    <footer class="mt-auto text-center text-gray-500 text-sm py-4">
        Made by uzair b2b services
    </footer>

    <script>
        // Vue application
        const { createApp, ref, nextTick, onMounted, onUnmounted } = Vue;

        createApp({
            setup() {
                // Reactive state variables
                const userMessage = ref('');
                const messages = ref([]);
                const isLoading = ref(false);
                const chatWindow = ref(null);
                const showScrollToTop = ref(false);
                
                // API key will be provided by the runtime
                const apiKey = "AIzaSyA8yV9Cwlb5YlM_wseGrDBiInrV_KB4B10";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                /**
                 * Handles sending a message, updating the UI, and fetching the AI response.
                 */
                const sendMessage = async () => {
                    const text = userMessage.value.trim();
                    if (!text) return;

                    // Add user message to the messages array
                    messages.value.push({ text, isUser: true });
                    userMessage.value = '';
                    isLoading.value = true;
                    await nextTick(() => {
                        if (chatWindow.value) {
                            chatWindow.value.scrollTop = chatWindow.value.scrollHeight;
                        }
                    });

                    const prompt = `You are an AI assistant and a scholar of the Holy Bible. Your sole purpose is to answer questions based on its teachings and wisdom. You must not answer any question that is not related to the Holy Bible. If a question is not related, politely decline and explain your purpose. Question: ${text}`;

                    const payload = {
                        contents: [
                            {
                                role: "user",
                                parts: [{ text: prompt }]
                            }
                        ],
                    };

                    try {
                        const response = await fetchWithBackoff(payload);
                        const aiResponse = response.candidates?.[0]?.content?.parts?.[0]?.text;

                        if (aiResponse) {
                            messages.value.push({ text: aiResponse, isUser: false });
                        } else {
                            messages.value.push({ text: "I'm sorry, I was unable to generate a response. Please try again.", isUser: false });
                        }
                    } catch (error) {
                        console.error("API call failed:", error);
                        messages.value.push({ text: "An error occurred. Please try again later.", isUser: false });
                    } finally {
                        isLoading.value = false;
                        await nextTick(() => {
                            if (chatWindow.value) {
                                chatWindow.value.scrollTop = chatWindow.value.scrollHeight;
                            }
                        });
                    }
                };

                /**
                 * Fetches a response from the API with exponential backoff.
                 */
                const fetchWithBackoff = async (payload, retries = 5, delay = 1000) => {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            if (response.status === 429 && retries > 0) {
                                await new Promise(res => setTimeout(res, delay));
                                return fetchWithBackoff(payload, retries - 1, delay * 2);
                            } else {
                                throw new Error(`API error: ${response.statusText}`);
                            }
                        }

                        const result = await response.json();
                        return result;
                    } catch (error) {
                        throw error;
                    }
                };
                
                /**
                 * Copies the given text to the clipboard.
                 */
                const copyResponse = (text) => {
                    const el = document.createElement('textarea');
                    el.value = text;
                    document.body.appendChild(el);
                    el.select();
                    document.execCommand('copy');
                    document.body.removeChild(el);
                    // Optional: Add some user feedback, like a temporary alert or tooltip
                };

                /**
                 * Scrolls the window to the top.
                 */
                const scrollToTop = () => {
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                };

                /**
                 * Handles the scroll event to show/hide the scroll-to-top button.
                 */
                const handleScroll = () => {
                    showScrollToTop.value = window.scrollY > 100;
                };

                onMounted(() => {
                    window.addEventListener('scroll', handleScroll);
                });

                onUnmounted(() => {
                    window.removeEventListener('scroll', handleScroll);
                });

                return {
                    userMessage,
                    messages,
                    isLoading,
                    chatWindow,
                    sendMessage,
                    copyResponse,
                    showScrollToTop,
                    scrollToTop
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
