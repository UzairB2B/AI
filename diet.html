<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diet.AI - Daily Diet Planner</title>
    <!-- Font link for Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- CDN for Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- CDN for Vue.js to handle reactivity and logic -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Font Awesome for copy and home icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased min-h-screen flex flex-col items-center justify-center">

    <!-- Vue.js app container -->
    <div id="app" class="flex flex-col flex-grow w-full max-w-4xl mx-auto rounded-xl shadow-lg overflow-hidden bg-white mt-6 mb-6 md:mt-12 md:mb-6">

        <!-- Header with responsive spacing and alignment -->
        <div class="flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 flex-wrap">
            <h1 class="text-xl sm:text-3xl font-extrabold text-gray-900 mb-2 sm:mb-0">UZAIR B2B AI (Diet.AI)</h1>
            <div class="flex items-center space-x-2">
                <!-- Home Button with responsive padding -->
                <a href="index.html" class="px-3 py-1 sm:px-4 sm:py-2 bg-gray-200 text-gray-700 rounded-full text-sm font-semibold shadow-md hover:bg-gray-300 transition-colors duration-200 flex items-center">
                    <i class="fas fa-home mr-2"></i>
                    Home
                </a>
                <p class="text-xs sm:text-sm text-gray-500">
                    Made with love by
                    <span class="text-blue-600">uzair b2b services</span>
                </p>
            </div>
        </div>

        <!-- Main Content Section -->
        <div class="p-6 flex flex-col flex-grow w-full">
            <p class="text-gray-600 mb-6 text-center">Your personal AI-powered daily diet planner.</p>
            
            <div class="form-section flex flex-col gap-4 mb-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="age-input" class="block mb-2 font-semibold text-gray-700">Age:</label>
                        <input v-model.number="age" type="number" id="age-input" class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out" placeholder="e.g., 30">
                    </div>
                    <div>
                        <label for="gender-select" class="block mb-2 font-semibold text-gray-700">Gender:</label>
                        <select v-model="gender" id="gender-select" class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out">
                            <option value="" disabled>Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="height-input" class="block mb-2 font-semibold text-gray-700">Height (in cm):</label>
                        <input v-model.number="height" type="number" id="height-input" class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out" placeholder="e.g., 175">
                    </div>
                    <div>
                        <label for="body-fat-input" class="block mb-2 font-semibold text-gray-700">Body Fat % (optional):</label>
                        <input v-model.number="bodyFat" type="number" id="body-fat-input" class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out" placeholder="e.g., 20">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="diet-type-select" class="block mb-2 font-semibold text-gray-700">Dietary Preference:</label>
                        <select v-model="dietType" id="diet-type-select" class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out">
                            <option value="" disabled>Select Preference</option>
                            <option value="vegetarian">Vegetarian</option>
                            <option value="non-vegetarian">Non-Vegetarian</option>
                            <option value="vegan">Vegan</option>
                        </select>
                    </div>
                    <div>
                        <label for="diet-style-select" class="block mb-2 font-semibold text-gray-700">Diet Style:</label>
                        <select v-model="dietStyle" id="diet-style-select" class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out">
                            <option value="" disabled>Select Style</option>
                            <option value="indian">Indian</option>
                            <option value="american">American</option>
                            <option value="mediterranean">Mediterranean</option>
                            <option value="keto">Keto</option>
                            <option value="paleo">Paleo</option>
                            <option value="low-carb">Low-Carb</option>
                            <option value="high-protein">High-Protein</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label for="goal-select" class="block mb-2 font-semibold text-gray-700">Goal:</label>
                    <select v-model="goal" id="goal-select" class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out">
                        <option value="" disabled>Select Goal</option>
                        <option value="cut">Cut (Lose Weight)</option>
                        <option value="bulk">Bulk (Gain Muscle)</option>
                        <option value="maintain">Maintain (Stay Healthy)</option>
                    </select>
                </div>
                
                <div>
                    <label for="diseases-input" class="block mb-2 font-semibold text-gray-700">Diseases / Medical Conditions (e.g., Diabetes, Hypertension):</label>
                    <textarea v-model="diseases" id="diseases-input" class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out h-24 resize-y" placeholder="Mention any health issues or allergies..."></textarea>
                </div>
                
                <div>
                    <label for="additional-info-input" class="block mb-2 font-semibold text-gray-700">Additional Information (e.g., allergies, food aversions):</label>
                    <textarea v-model="additionalInfo" id="additional-info-input" class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out h-24 resize-y" placeholder="Any other info that might be helpful..."></textarea>
                </div>
            </div>

            <div class="flex items-center justify-center mb-6">
                <button
                    @click="generateDietPlan"
                    class="w-full md:w-1/2 px-6 py-3 rounded-full bg-blue-600 text-white font-semibold shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
                    :disabled="!isFormValid || isLoading"
                >
                    <span v-if="!isLoading">Generate Diet Plan</span>
                    <svg v-else class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Message Box -->
            <div v-if="message" :class="['rounded-xl px-4 py-2 text-center text-sm font-medium mb-4', message.type === 'error' ? 'bg-red-200 text-red-800' : 'bg-blue-200 text-blue-800']">
                {{ message.text }}
            </div>

            <!-- Diet Plan Output -->
            <div v-if="dietPlanOutput" class="relative bg-white rounded-xl p-4 sm:p-6 text-gray-700 shadow-inner border border-gray-200 overflow-x-auto whitespace-pre-wrap break-words">
                <div class="flex justify-end">
                    <button @click="copyToClipboard" class="px-3 py-1 bg-gray-200 text-gray-700 rounded-full text-sm font-semibold hover:bg-gray-300 transition-colors duration-200 flex items-center">
                        <i class="fas fa-clipboard mr-2"></i>
                        Copy Plan
                    </button>
                </div>
                <pre class="mt-4">{{ dietPlanOutput }}</pre>
            </div>

            <!-- Placeholder text when no plan is generated -->
            <div v-else class="relative bg-white rounded-xl p-4 sm:p-6 text-gray-700 shadow-inner border border-gray-200 flex-grow flex items-center justify-center text-center italic">
                Your personalized daily diet plan will appear here.
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="mt-auto text-center text-gray-500 text-sm py-4">
        Made with love by uzair b2b services
    </footer>

    <script>
        // Vue application
        const { createApp, ref, computed } = Vue;

        createApp({
            setup() {
                // Reactive state variables
                const age = ref('');
                const gender = ref('');
                const height = ref('');
                const bodyFat = ref('');
                const dietType = ref('');
                const dietStyle = ref('');
                const goal = ref('');
                const diseases = ref('');
                const additionalInfo = ref('');
                
                const dietPlanOutput = ref('');
                const isLoading = ref(false);
                const message = ref(null);
                
                // API key will be provided by the runtime
                const apiKey = "AIzaSyBbfO_ahhxfIWpQxNrdo5U7XuWq1OPO7Fo";
                const geminiApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                /**
                 * A computed property to check if all required fields are filled.
                 */
                const isFormValid = computed(() => {
                    return age.value && gender.value && height.value && dietType.value && dietStyle.value && goal.value;
                });

                /**
                 * Helper function to show messages to the user.
                 */
                const showMessage = (text, type = 'info') => {
                    message.value = { text, type };
                };

                /**
                 * Handles fetching a response from the API with exponential backoff.
                 */
                const fetchWithBackoff = async (url, payload, retries = 5, delay = 1000) => {
                    try {
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            if (response.status === 429 && retries > 0) {
                                await new Promise(res => setTimeout(res, delay));
                                return fetchWithBackoff(url, payload, retries - 1, delay * 2);
                            } else {
                                throw new Error(`API error: ${response.statusText}`);
                            }
                        }

                        const result = await response.json();
                        return result;
                    } catch (error) {
                        throw error;
                    }
                };

                /**
                 * Handles the main logic for generating the diet plan.
                 */
                const generateDietPlan = async () => {
                    if (!isFormValid.value) {
                        showMessage("Please fill in all the required fields.", 'error');
                        return;
                    }

                    isLoading.value = true;
                    dietPlanOutput.value = '';
                    message.value = null;

                    let prompt = `You are an expert nutritionist and AI diet planner. Create a perfect, detailed daily diet plan for a person with the following characteristics:\n\n`;
                    prompt += `* Age: ${age.value} years\n`;
                    prompt += `* Gender: ${gender.value}\n`;
                    prompt += `* Height: ${height.value} cm\n`;
                    prompt += `* Goal: ${goal.value}\n`;
                    prompt += `* Dietary Preference: ${dietType.value}\n`;
                    prompt += `* Diet Style: ${dietStyle.value}\n`;
                    
                    if (bodyFat.value) {
                        prompt += `* Body Fat: ${bodyFat.value}%\n`;
                    }
                    if (diseases.value) {
                        prompt += `* Medical Conditions: ${diseases.value}\n`;
                    }
                    if (additionalInfo.value) {
                        prompt += `* Additional Information: ${additionalInfo.value}\n`;
                    }

                    prompt += `\nProvide the diet plan in a clear, easy-to-follow format, including meals for breakfast, lunch, dinner, and snacks. For each meal, list the specific food items and portion sizes. The plan should be realistic and effective for achieving the specified goal while considering all the provided information.`;

                    const chatHistory = [{
                        role: "user",
                        parts: [{ text: prompt }]
                    }];
                    const payload = { contents: chatHistory };

                    try {
                        const result = await fetchWithBackoff(geminiApiUrl, payload);
                        const aiResponse = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                        if (aiResponse) {
                            dietPlanOutput.value = aiResponse;
                            showMessage("Diet plan generated successfully!", 'info');
                        } else {
                            dietPlanOutput.value = "I'm sorry, I was unable to generate a diet plan. Please check your inputs and try again.";
                            showMessage("I'm sorry, I was unable to generate a diet plan. Please check your inputs and try again.", 'error');
                        }
                    } catch (error) {
                        console.error(error);
                        dietPlanOutput.value = "An error occurred. Please try again.";
                        showMessage("An error occurred. Please try again.", 'error');
                    } finally {
                        isLoading.value = false;
                    }
                };

                /**
                 * Copies the diet plan text to the user's clipboard.
                 */
                const copyToClipboard = () => {
                    if (dietPlanOutput.value) {
                        // Use the Clipboard API
                        if (navigator.clipboard) {
                            navigator.clipboard.writeText(dietPlanOutput.value).then(() => {
                                showMessage("Diet plan copied to clipboard!", 'info');
                            }).catch(err => {
                                console.error('Failed to copy using Clipboard API:', err);
                                fallbackCopyTextToClipboard();
                            });
                        } else {
                            fallbackCopyTextToClipboard();
                        }
                    }
                };

                /**
                 * Fallback function for copying text using execCommand.
                 * This is a workaround for environments where the Clipboard API is not available (like iframes).
                 */
                const fallbackCopyTextToClipboard = () => {
                    const tempTextArea = document.createElement("textarea");
                    tempTextArea.value = dietPlanOutput.value;
                    document.body.appendChild(tempTextArea);
                    tempTextArea.select();
                    try {
                        document.execCommand('copy');
                        showMessage("Diet plan copied to clipboard! (using fallback)", 'info');
                    } catch (err) {
                        console.error('Failed to copy text with execCommand:', err);
                        showMessage("Failed to copy text. Please try selecting and copying manually.", 'error');
                    }
                    document.body.removeChild(tempTextArea);
                };
                
                return {
                    age, gender, height, bodyFat, dietType, dietStyle, goal, diseases, additionalInfo,
                    dietPlanOutput,
                    isLoading,
                    message,
                    isFormValid,
                    generateDietPlan,
                    copyToClipboard
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
