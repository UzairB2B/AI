<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diet.AI - Daily Diet Planner</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            min-height: 80vh;
        }
        .input-group {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: 1fr;
        }
        @media (min-width: 640px) {
            .input-group {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .input-field, .select-field, .textarea-field {
            padding: 0.75rem;
            border-radius: 0.75rem;
            border: 1px solid #d1d5db;
            transition: all 0.2s ease-in-out;
            width: 100%;
        }
        .input-field:focus, .select-field:focus, .textarea-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            white-space: nowrap;
        }
        .btn-primary {
            background-color: #2563eb;
            color: #ffffff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #1d4ed8;
            transform: translateY(-2px);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top-color: #ffffff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        #diet-plan-output {
            background-color: #fafafa;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            flex-grow: 1;
            white-space: pre-wrap;
            min-height: 200px;
        }
        .message-box {
            background-color: #dbeafe;
            color: #1e40af;
            border-radius: 0.75rem;
            padding: 1rem;
            text-align: center;
            margin-top: 1rem;
        }
        .form-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        label {
            font-weight: 600;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="container">
        <h1 class="text-3xl sm:text-4xl font-extrabold mb-2 text-center text-gray-800">UZAIR B2B AI (Diet.AI)</h1>
        <p class="text-gray-600 mb-6 text-center">Your personal AI-powered daily diet planner.</p>
        
        <div class="form-section">
            <div class="input-group">
                <div>
                    <label for="age-input" class="block mb-2">Age:</label>
                    <input type="number" id="age-input" class="input-field" placeholder="e.g., 30">
                </div>
                <div>
                    <label for="gender-select" class="block mb-2">Gender:</label>
                    <select id="gender-select" class="select-field">
                        <option value="" disabled selected>Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <div>
                    <label for="height-input" class="block mb-2">Height (in cm):</label>
                    <input type="number" id="height-input" class="input-field" placeholder="e.g., 175">
                </div>
                <div>
                    <label for="body-fat-input" class="block mb-2">Body Fat % (optional):</label>
                    <input type="number" id="body-fat-input" class="input-field" placeholder="e.g., 20">
                </div>
            </div>

            <div class="input-group">
                <div>
                    <label for="diet-type-select" class="block mb-2">Dietary Preference:</label>
                    <select id="diet-type-select" class="select-field">
                        <option value="" disabled selected>Select Preference</option>
                        <option value="vegetarian">Vegetarian</option>
                        <option value="non-vegetarian">Non-Vegetarian</option>
                        <option value="vegan">Vegan</option>
                    </select>
                </div>
                <div>
                    <label for="diet-style-select" class="block mb-2">Diet Style:</label>
                    <select id="diet-style-select" class="select-field">
                        <option value="" disabled selected>Select Style</option>
                        <option value="indian">Indian</option>
                        <option value="american">American</option>
                        <option value="mediterranean">Mediterranean</option>
                        <option value="keto">Keto</option>
                        <option value="paleo">Paleo</option>
                        <option value="low-carb">Low-Carb</option>
                        <option value="high-protein">High-Protein</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>

            <div>
                <label for="goal-select" class="block mb-2">Goal:</label>
                <select id="goal-select" class="select-field">
                    <option value="" disabled selected>Select Goal</option>
                    <option value="cut">Cut (Lose Weight)</option>
                    <option value="bulk">Bulk (Gain Muscle)</option>
                    <option value="maintain">Maintain (Stay Healthy)</option>
                </select>
            </div>
            
            <div>
                <label for="diseases-input" class="block mb-2">Diseases / Medical Conditions (e.g., Diabetes, Hypertension):</label>
                <textarea id="diseases-input" class="textarea-field h-24" placeholder="Mention any health issues or allergies..."></textarea>
            </div>
            
            <div>
                <label for="additional-info-input" class="block mb-2">Additional Information (e.g., allergies, food aversions):</label>
                <textarea id="additional-info-input" class="textarea-field h-24" placeholder="Any other info that might be helpful..."></textarea>
            </div>
        </div>
        
        <div class="flex justify-center mb-6">
            <button id="generate-btn" class="btn btn-primary flex items-center justify-center">
                <span id="btn-text">Generate Diet Plan</span>
                <div id="loading-spinner" class="loading-spinner ml-2 hidden"></div>
            </button>
        </div>
        
        <div id="message-box" class="message-box hidden"></div>

        <div id="diet-plan-output" class="text-gray-700">
            Your personalized daily diet plan will appear here.
        </div>
    </div>
    
    <footer class="mt-8 text-center text-gray-500 text-sm">
        Made with love by uzair b2b services
    </footer>

    <script>
        const ageInput = document.getElementById('age-input');
        const genderSelect = document.getElementById('gender-select');
        const heightInput = document.getElementById('height-input');
        const bodyFatInput = document.getElementById('body-fat-input');
        const dietTypeSelect = document.getElementById('diet-type-select');
        const dietStyleSelect = document.getElementById('diet-style-select');
        const goalSelect = document.getElementById('goal-select');
        const diseasesInput = document.getElementById('diseases-input');
        const additionalInfoInput = document.getElementById('additional-info-input');
        const generateBtn = document.getElementById('generate-btn');
        const btnText = document.getElementById('btn-text');
        const loadingSpinner = document.getElementById('loading-spinner');
        const dietPlanOutput = document.getElementById('diet-plan-output');
        const messageBox = document.getElementById('message-box');

        const apiKey = "";
        const geminiApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        // Helper function to show messages
        function showMessage(message, type = 'info') {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden');
            if (type === 'error') {
                messageBox.style.backgroundColor = '#fecaca';
                messageBox.style.color = '#7f1d1d';
            } else {
                messageBox.style.backgroundColor = '#dbeafe';
                messageBox.style.color = '#1e40af';
            }
        }

        // Fetch API with exponential backoff
        async function fetchWithBackoff(url, payload, retries = 5, delay = 1000) {
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    if (response.status === 429 && retries > 0) {
                        await new Promise(res => setTimeout(res, delay));
                        return fetchWithBackoff(url, payload, retries - 1, delay * 2);
                    } else {
                        throw new Error(`API error: ${response.statusText}`);
                    }
                }
                const result = await response.json();
                return result;
            } catch (error) {
                console.error("API call failed:", error);
                throw error;
            }
        }
        
        async function generateDietPlan() {
            const age = ageInput.value.trim();
            const gender = genderSelect.value;
            const height = heightInput.value.trim();
            const bodyFat = bodyFatInput.value.trim();
            const dietType = dietTypeSelect.value;
            const dietStyle = dietStyleSelect.value;
            const goal = goalSelect.value;
            const diseases = diseasesInput.value.trim();
            const additionalInfo = additionalInfoInput.value.trim();

            // Bug fix: Show error message and return *before* changing button state.
            if (!age || !gender || !height || !dietType || !dietStyle || !goal) {
                showMessage("Please fill in all the required fields.", 'error');
                return;
            }

            // Set button to loading state
            generateBtn.disabled = true;
            btnText.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');
            dietPlanOutput.textContent = "Generating your personalized diet plan. This may take a moment...";
            messageBox.classList.add('hidden');

            try {
                let prompt = `You are an expert nutritionist and AI diet planner. Create a perfect, detailed daily diet plan for a person with the following characteristics:\n\n`;
                prompt += `* Age: ${age} years\n`;
                prompt += `* Gender: ${gender}\n`;
                prompt += `* Height: ${height} cm\n`;
                prompt += `* Goal: ${goal}\n`;
                prompt += `* Dietary Preference: ${dietType}\n`;
                prompt += `* Diet Style: ${dietStyle}\n`;
                
                if (bodyFat) {
                    prompt += `* Body Fat: ${bodyFat}%\n`;
                }
                if (diseases) {
                    prompt += `* Medical Conditions: ${diseases}\n`;
                }
                if (additionalInfo) {
                    prompt += `* Additional Information: ${additionalInfo}\n`;
                }

                prompt += `\nProvide the diet plan in a clear, easy-to-follow format, including meals for breakfast, lunch, dinner, and snacks. For each meal, list the specific food items and portion sizes. The plan should be realistic and effective for achieving the specified goal while considering all the provided information.`;

                const chatHistory = [{
                    role: "user",
                    parts: [{ text: prompt }]
                }];
                const payload = { contents: chatHistory };

                const result = await fetchWithBackoff(geminiApiUrl, payload);
                const aiResponse = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                if (aiResponse) {
                    dietPlanOutput.textContent = aiResponse;
                    showMessage("Diet plan generated successfully!");
                } else {
                    dietPlanOutput.textContent = "I'm sorry, I was unable to generate a diet plan. Please check your inputs and try again.";
                }
            } catch (error) {
                console.error(error);
                dietPlanOutput.textContent = "An error occurred. Please try again.";
            } finally {
                // Reset button state
                generateBtn.disabled = false;
                btnText.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
            }
        }

        generateBtn.addEventListener('click', generateDietPlan);
        
        // Add event listeners for Enter key on all input fields
        const inputFields = document.querySelectorAll('.input-field, .select-field, .textarea-field');
        inputFields.forEach(input => {
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    if (e.target.tagName !== 'TEXTAREA') {
                        generateDietPlan();
                    }
                }
            });
        });
    </script>
</body>
</html>
