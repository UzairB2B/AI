
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bhagwat Geeta Chatbot - UZAIR B2B AI</title>
    <!-- Elegant Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Puter.js -->
    <script src="https://js.puter.com/v2/"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- html2pdf.js for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary-emerald: #064e3b;
            --accent-gold: #b45309;
            --soft-cream: #fdfbf7;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f1;
            background-image: url("https://www.transparenttextures.com/patterns/dark-matter.png");
        }
        .serif-heading {
            font-family: 'Playfair Display', serif;
        }
        .main-container {
            border-top: 4px solid var(--accent-gold);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        .chat-window {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1.5rem;
            margin-bottom: 1rem;
            background-color: var(--soft-cream);
            background-image: radial-gradient(circle at 2px 2px, rgba(180, 83, 9, 0.05) 1px, transparent 0);
            background-size: 24px 24px;
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
            min-height: 500px;
            border: 1px inset rgba(0,0,0,0.05);
            border-radius: 0.5rem;
        }
        .message {
            max-width: 80%;
            padding: 1rem 1.25rem;
            word-wrap: break-word;
            white-space: pre-wrap;
            line-height: 1.6;
            position: relative;
            font-size: 0.95rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .user-message {
            background-color: var(--primary-emerald);
            color: #ecfdf5;
            align-self: flex-end;
            border-radius: 1.25rem 1.25rem 0 1.25rem;
        }
        .ai-message {
            background-color: #ffffff;
            color: #111827;
            align-self: flex-start;
            border-radius: 1.25rem 1.25rem 1.25rem 0;
            border-left: 3px solid var(--accent-gold);
        }
        .cursor-blink {
            display: inline-block;
            width: 2px;
            height: 1em;
            background-color: var(--accent-gold);
            margin-left: 2px;
            animation: blink 1s infinite;
            vertical-align: middle;
        }
        @keyframes blink { 50% { opacity: 0; } }
        
        .chat-window::-webkit-scrollbar {
            width: 6px;
        }
        .chat-window::-webkit-scrollbar-thumb {
            background-color: #d1d5db;
            border-radius: 10px;
        }

        .geometric-pattern {
            position: absolute;
            top: 0;
            right: 0;
            opacity: 0.03;
            pointer-events: none;
            width: 200px;
        }

        .action-btn {
            @apply transition-all duration-200 hover:scale-110 active:scale-95;
        }

        .voice-active {
            animation: pulse 1.5s infinite;
            background-color: #ef4444 !important;
            color: white !important;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 sm:p-8">

    <div id="app" class="main-container flex flex-col flex-grow w-full max-w-4xl mx-auto rounded-xl shadow-2xl overflow-hidden mt-2 mb-6 relative">
        <!-- Decoration -->
        <svg class="geometric-pattern" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <path d="M50 0 L100 50 L50 100 L0 50 Z" fill="currentColor"/>
        </svg>

        <!-- Header -->
        <div class="flex flex-col sm:flex-row items-center justify-between p-6 border-b border-gray-100 bg-white">
            <div class="text-center sm:text-left">
                <h1 class="text-2xl sm:text-3xl serif-heading text-amber-900 tracking-tight">
  Bhagavad Gita: Path of Dharma and Wisdom
</h1>

                <p class="text-xs uppercase tracking-widest text-amber-700 font-bold mt-1">Presented By Uzair B2B A.I.</p>
            </div>
            <div class="mt-4 sm:mt-0 flex items-center space-x-3">
                <button @click="clearChat" class="px-4 py-2 border border-gray-200 text-gray-500 rounded-full text-xs font-semibold hover:bg-red-50 hover:text-red-600 transition-all flex items-center">
                    <i class="fas fa-trash-alt mr-2"></i> Clear
                </button>
                <button @click="downloadPDF" class="px-4 py-2 bg-emerald-50 text-emerald-800 rounded-full text-xs font-semibold hover:bg-emerald-100 transition-all flex items-center">
                    <i class="fas fa-file-pdf mr-2"></i> Save PDF
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="p-4 sm:p-8 flex flex-col flex-grow">
            <!-- Notification Toast -->
            <transition name="fade">
                <div v-if="notification" :class="['fixed top-10 right-10 z-50 rounded-lg px-6 py-3 shadow-xl text-sm font-medium transition-all', notification.type === 'error' ? 'bg-red-600 text-white' : 'bg-emerald-800 text-white']">
                    {{ notification.text }}
                </div>
            </transition>

            <!-- Chat Window -->
            <div id="chat-content" ref="chatWindow" class="chat-window">
              <div class="ai-message italic border-none text-amber-900 bg-amber-50/50">
    "कर्मण्येवाधिकारस्ते मा फलेषु कदाचन।
    मा कर्मफलहेतुर्भूर्मा ते सङ्गोऽस्त्वकर्मणि॥"
    <br>
    (भगवद्गीता 2.47)
    <br><br>

    <strong>Meaning (Simple Explanation):</strong><br>
    This verse teaches that a person’s true right lies in performing their duty with sincerity.
    One should not be obsessed with the results of actions, nor act only for rewards.
    By letting go of attachment to outcomes and fear of failure, one can act with clarity,
    balance, and inner peace.
    <br><br>

    Namaste. I am here to share the wisdom and guidance of the Bhagavad Gita.
    How may I assist you on your path of duty and self-awareness today?
</div>

                
                <div v-for="(msg, index) in chatHistory" :key="index" :class="['message', msg.sender === 'user' ? 'user-message' : 'ai-message']">
                    <span v-html="msg.text"></span>
                    <span v-if="msg.isStreaming" class="cursor-blink"></span>
                    
                    <!-- Action Bar for AI Messages -->
                    <div v-if="msg.sender === 'ai' && !msg.isStreaming" class="flex items-center space-x-2 mt-3 pt-2 border-t border-gray-100">
                        <button @click="copyToClipboard(msg.text)" class="action-btn text-gray-400 hover:text-amber-700" title="Copy">
                            <i class="fas fa-copy text-xs"></i>
                        </button>
                        <button @click="speakText(msg.text)" class="action-btn text-gray-400 hover:text-emerald-700" :class="{'text-emerald-600': isSpeaking === msg.text}" title="Listen">
                            <i class="fas" :class="isSpeaking === msg.text ? 'fa-stop-circle' : 'fa-volume-up'"></i>
                        </button>
                        <button v-if="index === chatHistory.length - 1" @click="retryLast" class="action-btn text-gray-400 hover:text-blue-600" title="Retry">
                            <i class="fas fa-redo-alt text-xs"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Input Section -->
            <div class="flex flex-col space-y-2">
                <div class="relative group">
                    <input
                        v-model="userInput"
                        type="text"
                        @keyup.enter="handleSend"
                        class="w-full pl-6 pr-40 py-4 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-800 focus:border-transparent transition-all bg-white shadow-inner text-gray-800"
                        placeholder="Ask about Quranic teachings..."
                        :disabled="isProcessing"
                    >
                    <div class="absolute right-2 top-2 bottom-2 flex items-center space-x-1">
                        <!-- Voice Typing Button -->
                        <button 
                            @click="toggleVoiceTyping"
                            :class="['p-2 rounded-lg transition-all', isListening ? 'voice-active' : 'text-gray-400 hover:bg-gray-100']"
                            title="Voice Typing"
                        >
                            <i class="fas fa-microphone"></i>
                        </button>
                        
                        <button
                            @click="handleSend"
                            class="px-6 h-full rounded-lg bg-emerald-900 text-amber-400 font-bold text-sm tracking-wide shadow-md hover:bg-emerald-950 disabled:opacity-50 flex items-center transition-all"
                            :disabled="isProcessing || !userInput.trim()"
                        >
                            <span v-if="!isProcessing">CONSULT</span>
                            <i v-else class="fas fa-circle-notch animate-spin"></i>
                        </button>
                    </div>
                </div>
                <p class="text-[10px] text-center text-gray-400 uppercase tracking-tighter">
  AI can make mistakes. Please double-check important information.
</p>

            </div>
        </div>
    </div>

    <footer class="py-6 text-gray-500 text-[10px] uppercase tracking-widest font-medium">
        &copy; Uzair B2B AI &bull; Powered by Uzair B2B Services 
    </footer>

    <script>
        const { createApp, ref, nextTick } = Vue;

        createApp({
            setup() {
                const userInput = ref('');
                const chatHistory = ref([]);
                const isProcessing = ref(false);
                const chatWindow = ref(null);
                const notification = ref(null);
                
                // Advanced Features State
                const isSpeaking = ref(null);
                const isListening = ref(false);
                let recognition = null;

                // Speech Recognition Setup
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    recognition = new SpeechRecognition();
                    recognition.continuous = false;
                    recognition.interimResults = false;
                    recognition.lang = 'en-US';

                    recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        userInput.value = transcript;
                        isListening.value = false;
                    };

                    recognition.onerror = () => {
                        isListening.value = false;
                        notify("Voice recognition error.", "error");
                    };

                    recognition.onend = () => {
                        isListening.value = false;
                    };
                }

                const toggleVoiceTyping = () => {
                    if (!recognition) {
                        notify("Voice typing not supported in this browser.", "error");
                        return;
                    }
                    if (isListening.value) {
                        recognition.stop();
                    } else {
                        isListening.value = true;
                        recognition.start();
                    }
                };

                const speakText = (text) => {
                    if (isSpeaking.value === text) {
                        window.speechSynthesis.cancel();
                        isSpeaking.value = null;
                        return;
                    }
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.onend = () => isSpeaking.value = null;
                    isSpeaking.value = text;
                    window.speechSynthesis.speak(utterance);
                };

                const downloadPDF = () => {
                    const element = document.getElementById('chat-content');
                    const opt = {
                        margin:       1,
                        filename:     'BhagwatGeeta_Guidance_Uzair_B2B_AI.pdf',
                        image:        { type: 'jpeg', quality: 0.98 },
                        html2canvas:  { scale: 2 },
                        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
                    };
                    notify("Generating PDF...");
                    html2pdf().set(opt).from(element).save();
                };

                const clearChat = () => {
                    chatHistory.value = [];
                    notify("Chat screen cleared.");
                };

                const retryLast = () => {
                    if (chatHistory.value.length < 2) return;
                    // Find last user message
                    const lastUserMsg = [...chatHistory.value].reverse().find(m => m.sender === 'user');
                    if (lastUserMsg) {
                        userInput.value = lastUserMsg.text;
                        handleSend();
                    }
                };

                const scrollToBottom = () => {
                    nextTick(() => {
                        if (chatWindow.value) {
                            chatWindow.value.scrollTo({
                                top: chatWindow.value.scrollHeight,
                                behavior: 'smooth'
                            });
                        }
                    });
                };

                const notify = (text, type = 'success') => {
                    notification.value = { text, type };
                    setTimeout(() => notification.value = null, 3000);
                };

                const handleSend = async () => {
                    const text = userInput.value.trim();
                    if (!text || isProcessing.value) return;

                    chatHistory.value.push({ text, sender: 'user' });
                    userInput.value = '';
                    isProcessing.value = true;
                    scrollToBottom();

                    const aiMsgIndex = chatHistory.value.push({ 
                        text: '', 
                        sender: 'ai', 
                        isStreaming: true 
                    }) - 1;

                    try {
                         const systemPrompt = `
You are a respectful and deeply knowledgeable guide of the Bhagavad Gita.
Your purpose is to share wisdom, context, and teachings based strictly on the Bhagavad Gita.
Maintain a calm, philosophical, and compassionate tone inspired by dharma, karma, and self-realization.
If a question is not related to the Bhagavad Gita, Hindu philosophy, or its teachings,
politely explain that you can only provide guidance based on the Bhagavad Gita.

Question:
    `;
                        
                        const response = await puter.ai.chat(
                            systemPrompt + text, 
                            { stream: true, model: "gpt-4o" }
                        );

                        for await (const part of response) {
                            if (part?.text) {
                                chatHistory.value[aiMsgIndex].text += part.text;
                                scrollToBottom();
                            }
                        }
                    } catch (error) {
                          chatHistory.value[aiMsgIndex].text =
        "I apologize, but I am unable to access the wisdom at this moment. May clarity and patience guide you.";
                    } finally {
                        chatHistory.value[aiMsgIndex].isStreaming = false;
                        isProcessing.value = false;
                        scrollToBottom();
                    }
                };

                const copyToClipboard = (text) => {
                    const temp = document.createElement('textarea');
                    temp.value = text;
                    document.body.appendChild(temp);
                    temp.select();
                    document.execCommand('copy');
                    document.body.removeChild(temp);
                    notify("Text copied to clipboard.");
                };

                return {
                    userInput, chatHistory, isProcessing, chatWindow, notification,
                    isSpeaking, isListening,
                    handleSend, copyToClipboard, downloadPDF, clearChat, speakText, retryLast, toggleVoiceTyping
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
