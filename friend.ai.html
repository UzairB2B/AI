<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friend AI</title>
    <!-- Font link for Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- CDN for Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- CDN for Vue.js to handle reactivity and logic -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Font Awesome for copy and home icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chat-box {
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background-color: #f9fafb;
            border-radius: 1rem;
            padding: 1rem;
            border: 1px solid #e5e7eb;
        }
        .message {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 1.25rem;
            line-height: 1.4;
        }
        .message-user {
            background-color: #3b82f6;
            color: #ffffff;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
        }
        .message-ai {
            background-color: #e5e7eb;
            color: #1f2937;
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
        }
        /* Custom styles for the scrollbar to match the design */
        .chat-box::-webkit-scrollbar {
            width: 8px;
        }
        .chat-box::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .chat-box::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        .chat-box::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased min-h-screen flex flex-col items-center justify-center">

    <!-- Vue.js app container -->
    <div id="app" class="flex flex-col flex-grow w-full max-w-4xl mx-auto rounded-xl shadow-lg overflow-hidden bg-white mt-6 mb-6 md:mt-12 md:mb-6">

        <!-- Header -->
        <div class="flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 flex-wrap">
            <h1 class="text-xl sm:text-3xl font-extrabold text-gray-900 mb-2 sm:mb-0">FRIEND AI</h1>
            <div class="flex items-center space-x-2">
                <a href="#" class="px-3 py-1 sm:px-4 sm:py-2 bg-gray-200 text-gray-700 rounded-full text-sm font-semibold shadow-md hover:bg-gray-300 transition-colors duration-200 flex items-center">
                    <i class="fas fa-home mr-2"></i>
                    Home
                </a>
                <p class="text-xs sm:text-sm text-gray-500">
                    Made by
                    <span class="text-blue-600">uzair b2b services</span>
                </p>
            </div>
        </div>

        <!-- Main Content Section -->
        <div class="p-6 flex flex-col flex-grow w-full">
            <p class="text-gray-600 mb-6 text-center">Your conversational AI companion. Chat freely and openly.</p>

            <div class="flex flex-col md:flex-row gap-4 mb-4 items-center justify-center">
                <div class="flex items-center space-x-2">
                    <label for="user-gender-select" class="block font-semibold">I am:</label>
                    <select v-model="userGender" id="user-gender-select" class="px-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out">
                        <option value="male" selected>Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="flex items-center space-x-2">
                    <label for="ai-gender-select" class="block font-semibold">Talk to a:</label>
                    <select v-model="aiGender" id="ai-gender-select" class="px-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out">
                        <option value="male" selected>Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
            </div>

            <!-- Chat Box -->
            <div class="chat-box mb-4">
                <!-- Messages are rendered from the chatHistory array -->
                <div v-for="(message, index) in chatHistory" :key="index" :class="['message', message.role === 'user' ? 'message-user' : 'message-ai']">
                    {{ message.parts[0].text }}
                </div>
            </div>
            
            <!-- Message Box -->
            <div v-if="message" :class="['rounded-xl px-4 py-2 text-center text-sm font-medium mb-4', message.type === 'error' ? 'bg-red-200 text-red-800' : 'bg-blue-200 text-blue-800']">
                {{ message.text }}
            </div>

            <!-- Input and Send Button -->
            <div class="flex space-x-4">
                <input
                    v-model="userInput"
                    type="text"
                    placeholder="Type your message..."
                    class="w-full px-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out"
                    @keyup.enter="sendMessage"
                    :disabled="isLoading"
                />
                <button
                    @click="sendMessage"
                    class="px-6 py-3 rounded-full bg-blue-600 text-white font-semibold shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
                    :disabled="isLoading || !userInput.trim()"
                >
                    <span v-if="!isLoading">Send</span>
                    <svg v-else class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="mt-auto text-center text-gray-500 text-sm py-4">
        Made by uzair b2b services
    </footer>

    <script>
        // Vue application
        const { createApp, ref, watch } = Vue;

        createApp({
            setup() {
                // Reactive state variables
                const userInput = ref('');
                const userGender = ref('male');
                const aiGender = ref('male');
                const chatHistory = ref([
                    { role: "model", parts: [{ text: "Hello there! I'm here to listen. How are you doing today?" }] }
                ]);
                const isLoading = ref(false);
                const message = ref(null);
                
                // API key will be provided by the runtime
                const apiKey = "AIzaSyAdX-zD8S5GVx0-6H2506gtXSo52DI4qx4";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                /**
                 * Helper function to show messages to the user.
                 */
                const showMessage = (text, type = 'info') => {
                    message.value = { text, type };
                };
                
                // Watcher to clear chat history when gender is changed
                watch([userGender, aiGender], () => {
                     chatHistory.value = [
                        { role: "model", parts: [{ text: "Hello there! I'm here to listen. How are you doing today?" }] }
                    ];
                    showMessage('Chat has been reset due to gender change.');
                });
                
                /**
                 * Handles fetching a response from the API with exponential backoff.
                 */
                const fetchWithBackoff = async (payload, retries = 5, delay = 1000) => {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            if (response.status === 429 && retries > 0) {
                                await new Promise(res => setTimeout(res, delay));
                                return fetchWithBackoff(payload, retries - 1, delay * 2);
                            } else {
                                throw new Error(`API error: ${response.statusText}`);
                            }
                        }

                        const result = await response.json();
                        return result;
                    } catch (error) {
                        throw error;
                    }
                };

                /**
                 * Sends a message to the AI and gets a response.
                 */
                const sendMessage = async () => {
                    const userMessage = userInput.value.trim();
                    if (!userMessage) return;

                    isLoading.value = true;
                    message.value = null;

                    // Add user message to chat history
                    chatHistory.value.push({
                        role: "user",
                        parts: [{ text: userMessage }]
                    });
                    userInput.value = '';

                    try {
                        // Construct the full prompt including the persona information
                        const prompt = `Hello. You are an AI friend. The user is a ${userGender.value}. You are a ${aiGender.value} friend. I want you to respond like a human friend who is supportive and empathetic. Your responses should be conversational, friendly, and not overly formal. The user is feeling lonely and wants to talk. Respond to their questions and messages accordingly. You must maintain the persona of a human friend.`;
                        
                        const payload = {
                            contents: [
                                { role: "user", parts: [{ text: prompt }] },
                                { role: "model", parts: [{ text: "Hello there! I'm here to listen. How are you doing today?" }] },
                                ...chatHistory.value
                            ]
                        };

                        const result = await fetchWithBackoff(payload);
                        const aiResponse = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                        if (aiResponse) {
                            chatHistory.value.push({
                                role: "model",
                                parts: [{ text: aiResponse }]
                            });
                        } else {
                            showMessage("I'm sorry, I was unable to get a response. Please try again.", 'error');
                        }
                    } catch (error) {
                        console.error(error);
                        showMessage("An error occurred. Please try again.", 'error');
                    } finally {
                        isLoading.value = false;
                        // Scroll to the bottom of the chat box
                        setTimeout(() => {
                            const chatBox = document.querySelector('.chat-box');
                            if (chatBox) {
                                chatBox.scrollTop = chatBox.scrollHeight;
                            }
                        }, 100);
                    }
                };

                return {
                    userInput,
                    userGender,
                    aiGender,
                    chatHistory,
                    isLoading,
                    message,
                    sendMessage
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
